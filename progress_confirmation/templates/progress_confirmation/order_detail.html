{% extends 'progress_confirmation/base.html' %}
{% block content %}
<div class="bg-white rounded-xl shadow p-4">
  <div class="flex justify-between">
    <div>
      <h2 class="text-xl font-semibold">{{ order.product_name }} ({{ order.order_no }})</h2>
      <p class="text-sm text-gray-500">数量: {{ order.quantity }} · 納期: {{ order.due_date }}</p>
      <p class="mt-2">状態: <strong>{{ order.status }}</strong></p>
    </div>
    <div>
      <a href="{% url 'index' %}" class="text-sm text-blue-600">一覧に戻る</a>
    </div>
  </div>

  <hr class="my-4">

  <h3 class="font-medium mb-2">工程</h3>
  <div class="space-y-2">
    {% for p in processes %}
    <div class="flex items-center justify-between p-2 border rounded">
      <div>
        <div class="font-semibold">{{ p.order }}. {{ p.name }}</div>
      </div>
      <div class="flex items-center gap-2">
        {% if order.current_process and p.id == order.current_process.id %}
          <span class="px-2 py-1 rounded bg-blue-100 text-blue-800">現在工程</span>
        {% endif %}
        <a href="{% url 'start_process' order.id p.id %}" class="px-3 py-1 bg-blue-600 text-white rounded text-sm">開始</a>
        <a href="{% url 'complete_process' order.id p.id %}" class="px-3 py-1 bg-green-600 text-white rounded text-sm">完了</a>
      </div>
    </div>
    {% endfor %}
  </div>

  <hr class="my-4">

  <h3 class="font-medium mb-2">履歴</h3>
  <div class="space-y-2">
    {% for l in logs %}
    <div class="p-2 border rounded">
      <div class="text-sm">{{ l.process.name }} — {{ l.worker_name }}</div>
      <div class="text-xs text-gray-500">開始: {{ l.start_time }} {% if l.end_time %}／完了: {{ l.end_time }}{% endif %}</div>
    </div>
    {% empty %}
    <div class="text-sm text-gray-500">履歴はありません</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
